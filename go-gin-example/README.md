## 一个 Gin 的 Demo

- 用到的技术栈有：`gin`、`gorm`、`jwt-go`、`ini`

### 2022-4-27 热更新

- 热更新目的
  1. 不关闭现有连接（正在运行中的程序）
  2. 新的进程启动并代替旧进程
  3. 新的进程接管**新**的连接
  4. 旧用户仍在请求旧连接时要保持连接，新用户应请求新进程，不可拒绝请求
- 热更新重启流程：
  1. 替换可执行文件或修改配置
  2. 发送信号量 `SIGHUP`，进程可以捕捉该信号并执行相关的处理函数
  3. 拒绝新连接请求旧进程，但要保证旧连接正常
  4. 启动新的子进程
  5. 新的子进程开始 `Accet`
  6. 系统将新的连接请求转交给新的子进程
  7. 旧进程处理完所有旧连接后正常结束 
- **优雅的重启**：使用 `endless` 实现零停机重新启动服务，`endless server` 监听以下几种信号量
  1. `syscall.SIGHUP`：触发 `fork` 子进程和重新启动（`kill -1 pid`）
  2. `syscall.SIGUSR1 / syscall.SIGTSTP`：被监听，但不会触发任何动作
  3. `syscall.SIGUSR2`：触发 `hammerTime`
  4. `syscall.SIGINT / syscall.SIGTERM`：触发服务器关闭（会完成正在运行的请求）
  > `endless` 热更新：创建子进程后将原进程退出，有点不符合守护进程的要求
- **优雅的关闭**：`http.Server` 的 `Shutdown` 方法
  


   